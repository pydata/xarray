trigger:
  - master

pr:
  - master

jobs:

- job: Linux
  strategy:
    matrix:
      py35-min:
        conda_env: py35-min
      py36:
        conda_env: py36
      py37:
        conda_env: py37
      py36-rasterio:
        conda_env: py36-rasterio
      py36-dask-dev:
        conda_env: py36-dask-dev
      py36-zarr-dev:
        conda_env: py36-zarr-dev
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - template: ci/azure/install.yml
  - template: ci/azure/run-tests.yml

- job: macOS
  strategy:
    matrix:
      py35-min:
        conda_env: py35-min
      py37:
        conda_env: py37
  pool:
    vmImage: 'macOS-10.13'
  steps:
  - template: ci/azure/install.yml
  - template: ci/azure/run-tests.yml

- job: Windows
  strategy:
    matrix:
      py35-min:
        conda_env: py35-min
      py37:
        conda_env: py37
  pool:
    vmImage: 'vs2017-win2016'
  steps:
  - template: ci/azure/install.yml
  - template: ci/azure/run-tests.yml

- job: CodeChecks
  variables:
    py37:
      conda_env: py37
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - template: ci/azure/install.yml
  - template: ci/azure/run-checks.yml

- job: Docs
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - template: ci/azure/install.yml
    parameters:
      env_file: doc/requirements.yml
  - displayName: Build docs
    bash: |
      conda activate test_env
      cd doc
      sphinx-build -n -j auto -b html -d _build/doctrees . _build/html

- job: Linux-Hypothesis
  variables:
    conda_env: py36-hypothesis
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - template: ci/azure/install.yml
  - bash: |
    conda activate test_env
    pytest properties

- job: Linux-AllowedFailures
  strategy:
    matrix:
      py36-pandas-dev:
        conda_env: py36-pandas-dev
  pool:
    vmImage: 'ubuntu-16.04'
  steps:
  - template: ci/azure/install.yml
  - template: ci/azure/run-tests.yml
  continueOnError: 'true'
